""" Test for smd_parser module"""

from pathlib import Path
from src.smd_parser import Animation
import pytest


@pytest.fixture
def smd_test_file(tmp_path) -> Path:
    """Creating test file"""
    root_dir = tmp_path / "dir"
    root_dir.mkdir()
    (root_dir / "move_file.smd").write_text("""
    // Created by Crowbar 0.74
    version 1
    nodes
      0 "pelvis" -1
      1 "lean_root" -1
      2 "cam_driver" -1
      3 "spine_0" 0
      4 "spine_1" 3
      5 "spine_2" 4
      6 "spine_3" 5
      7 "neck_0" 6
      8 "head_0" 7
      9 "clavicle_L" 6
      10 "arm_upper_L" 9
      11 "arm_lower_L" 10
      12 "hand_L" 11
      13 "finger_middle_meta_L" 12
      14 "finger_middle_0_L" 13
      15 "finger_middle_1_L" 14
    end
    skeleton
      time 0
        0 9.542567 0.066408 38.889910 0.155618 -1.443476 2.287331
        1 0.000000 0.000000 0.000000 0.000000 0.000000 -1.570796
        2 0.000000 0.000000 64.000000 0.000000 0.000000 -1.570796
        3 0.934204 0.090506 0.000000 -0.026000 -0.070913 0.248963
        4 3.863241 0.000001 0.000000 -0.075536 -0.080951 0.089858
        5 4.564383 0.000000 0.000000 -0.035082 -0.000193 0.002626
        6 6.648561 0.000001 0.000000 -0.014226 0.096636 0.144828
        7 6.651928 -0.000017 0.000000 -0.025959 -0.049484 0.187282
        8 5.230899 -0.296882 0.273446 0.497811 -0.003226 -0.360050
        9 4.311546 3.005295 1.270492 2.014360 -1.079695 -2.025331
        10 6.665431 -0.000001 0.000004 0.204288 -0.663235 0.279905
        11 11.596657 0.000000 0.000004 0.000000 0.000000 0.444714
        12 11.486958 0.000000 0.000000 1.508139 -0.052952 0.048995
        13 0.807848 0.015446 -0.224507 0.103565 -0.098441 -0.078206
        14 3.265085 0.000000 0.000000 0.041931 -0.052018 0.432386
        15 2.075729 0.000000 0.000000 0.004352 0.027174 0.353438
      time 1
        0 12.252342 0.082034 38.776626 0.174120 -1.439018 2.307753
        1 2.940251 0.000000 0.000000 0.000000 0.000000 -1.570796
        2 2.940251 0.000000 64.000000 0.000000 0.000000 -1.570796
        3 0.934204 0.090506 0.000000 -0.024463 -0.066179 0.251561
        4 3.863241 0.000001 0.000000 -0.090500 -0.079343 0.087072
        5 4.564383 0.000000 0.000000 -0.049657 0.001022 0.004009
        6 6.648561 0.000001 0.000000 -0.027979 0.099046 0.144399
        7 6.651928 -0.000017 0.000000 -0.026318 -0.049904 0.188913
        8 5.238712 -0.289069 0.273446 0.501874 -0.002332 -0.360391
        9 4.311546 3.005295 1.270492 2.014360 -1.079695 -2.025331
        10 6.665431 -0.000001 0.000004 0.204288 -0.663235 0.279905
        11 11.596657 0.000000 0.000004 0.000000 0.000000 0.444714
        12 11.486958 0.000000 0.000000 1.508139 -0.052952 0.048995
        13 0.807848 0.015446 -0.224507 0.103565 -0.098441 -0.078206
        14 3.265085 0.000000 0.000000 0.041931 -0.052018 0.432386
        15 2.075729 0.000000 0.000000 0.004352 0.027174 0.353438
    end
    """)
    return tmp_path


def test_smd_parser(smd_test_file):
    """ Test for smd_parser func """

    animation = Animation(str(smd_test_file.joinpath("dir/move_file.smd")))

    assert animation.get_bone(0) == "pelvis"
    assert animation.get_bone(1) == "lean_root"

    assert animation.get_time(0).get_bone(0).x == 9.542567
    assert animation.get_time(0).get_bone(0).y == 0.066408
    assert animation.get_time(0).get_bone(0).z == 38.889910

    assert animation.get_time(1).get_bone(1).x == 2.940251
    assert animation.get_time(1).get_bone(1).y == 0.000000
    assert animation.get_time(1).get_bone(1).z == 0.000000
